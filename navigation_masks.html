<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Navigation Masks - bevy_northstar Documentation</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Usage</li><li class="chapter-item expanded "><a href="getting_started.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="grid_settings.html"><strong aria-hidden="true">3.</strong> Grid Settings</a></li><li class="chapter-item expanded "><a href="nav_data.html"><strong aria-hidden="true">4.</strong> Navigation Data</a></li><li class="chapter-item expanded "><a href="grid_updates.html"><strong aria-hidden="true">5.</strong> Grid Updates</a></li><li class="chapter-item expanded affix "><li class="part-title">Pathfinding</li><li class="chapter-item expanded "><a href="pathfinding/01_plugin.html"><strong aria-hidden="true">6.</strong> With NorthstarPlugin</a></li><li class="chapter-item expanded "><a href="pathfinding/02_modes.html"><strong aria-hidden="true">7.</strong> Modes / Algorithms</a></li><li class="chapter-item expanded "><a href="pathfinding/03_path.html"><strong aria-hidden="true">8.</strong> Path Component/Struct</a></li><li class="chapter-item expanded "><a href="pathfinding/04_manual_pathfinding.html"><strong aria-hidden="true">9.</strong> Manual Pathfinding</a></li><li class="chapter-item expanded affix "><li class="part-title">Neighborhood</li><li class="chapter-item expanded "><a href="neighborhood/01_neighborhoods.html"><strong aria-hidden="true">10.</strong> Neighborhoods</a></li><li class="chapter-item expanded "><a href="neighborhood/02_filters.html"><strong aria-hidden="true">11.</strong> Filters</a></li><li class="chapter-item expanded affix "><li class="part-title">Navigation Masks</li><li class="chapter-item expanded "><a href="navigation_masks.html" class="active"><strong aria-hidden="true">12.</strong> Navigation Masks</a></li><li class="chapter-item expanded affix "><li class="part-title">Debugging</li><li class="chapter-item expanded "><a href="debugging.html"><strong aria-hidden="true">13.</strong> Debugging</a></li><li class="chapter-item expanded affix "><li class="part-title">Migration Guides</li><li class="chapter-item expanded "><a href="migrations/001_v0.3.0.html"><strong aria-hidden="true">14.</strong> From v0.2.X to v0.3.X</a></li><li class="chapter-item expanded "><a href="migrations/002_v0.4.0.html"><strong aria-hidden="true">15.</strong> From v0.3.X to v0.4.X</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">bevy_northstar Documentation</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="navigation-masks"><a class="header" href="#navigation-masks">Navigation Masks</a></h1>
<p>Navigation masks are an advanced feature let you change the grid cell cost and impassability per agent on a per-call basis.</p>
<h2 id="navigation-mask-layers"><a class="header" href="#navigation-mask-layers">Navigation Mask Layers</a></h2>
<p>A <code>NavMaskLayer</code> defines a layer of navigation data masks. Layers are then combined in <code>NavMask</code>. This allows you to represent special conditions (e.g., water tiles, faction boundaries) and assign them to individual agents through masks.</p>
<p>Most <code>NavMaskLayer</code> methods require a reference to a <code>Grid</code> to define bounds for caching data.</p>
<h3 id="navmasklayerinsert_maskgrid-pos-mask"><a class="header" href="#navmasklayerinsert_maskgrid-pos-mask"><code>NavMaskLayer::insert_mask(grid, pos, mask)</code></a></h3>
<p>Set a mask at a single cell.</p>
<h3 id="navmasklayerinsert_region_fillgrid-region-mask"><a class="header" href="#navmasklayerinsert_region_fillgrid-region-mask"><code>NavMaskLayer::insert_region_fill(grid, region, mask)</code></a></h3>
<p>Fill an entire region with the same mask.</p>
<h3 id="navmasklayerinsert_region_outlinegrid-region-mask"><a class="header" href="#navmasklayerinsert_region_outlinegrid-region-mask"><code>NavMaskLayer::insert_region_outline(grid, region, mask)</code></a></h3>
<p>Apply a mask to the outline of a region. Useful for constraining agents with <code>NavCellMask::ImpassableOverride</code>.</p>
<h3 id="navmasklayerinsert_hashmapgrid-masksuvec3-navcellmask"><a class="header" href="#navmasklayerinsert_hashmapgrid-masksuvec3-navcellmask"><code>NavMaskLayer::insert_hashmap(grid, masks&lt;UVec3, NavCellMask&gt;)</code></a></h3>
<p>Populate the layer from a <code>HashMap</code> of positions and masks.</p>
<h3 id="navmasklayerinsert_hashsetgrid-masksuvec3-mask"><a class="header" href="#navmasklayerinsert_hashsetgrid-masksuvec3-mask"><code>NavMaskLayer::insert_hashset(grid, masks&lt;UVec3&gt;, mask)</code></a></h3>
<p>Apply the same mask to all positions in the set.</p>
<h3 id="navmasklayerclear"><a class="header" href="#navmasklayerclear"><code>NavMaskLayer::clear()</code></a></h3>
<p>Remove all data from the layer including the cache.</p>
<p>See <a href="#navcellmask">NavCellMask</a> for mask options.</p>
<blockquote>
<p>⚠️ Arc Result
<code>NavMaskLayer</code> is an <code>Arc&lt;Mutex&gt;</code> wrapper so it can be shared in Bevy systems.<br />
All methods return a <code>Result</code>. Errors are returned as <code>String</code> if the data lock fails.</p>
</blockquote>
<h3 id="example-creating-a-navigation-mask-layer"><a class="header" href="#example-creating-a-navigation-mask-layer">Example: Creating a navigation mask layer</a></h3>
<pre><pre class="playground"><code class="language-rust no_run">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let layer = NavMaskLayer::new();
layer.insert_region_fill(
    &amp;grid,
    NavRegion::new(UVec3::new(0, 0, 0), UVec3::new(10, 10, 10)),
    NavCellMask::ModifyCost(5),
).ok();
<span class="boring">}
</span></code></pre></pre>
<h2 id="navigation-mask"><a class="header" href="#navigation-mask">Navigation Mask</a></h2>
<p>A <code>NavMask</code> combines one or more layers and is used during pathfinding or passed in for manual pathfinding calls.
Masks can be shared across agents or created per agent.</p>
<p>Layers are processed in order added with the last layer modifying last.</p>
<blockquote>
<p>If a cell is impassable in the grid or in any layer with <code>NavCellMask::ImpassableOverride</code>, the cell is regarded as impassable. Because neighbors are precomputed on the grid it is not currently possible to take an impassable grid cell and make it passable. If such behavior is desired, one strategy would be to make it passable on the grid and apply an impassable mask cell for your agents.</p>
</blockquote>
<p><code>NavMask</code> also includes a cache for mask HPA* lookups. See <a href="#performance-notes">Performance Notes</a>.</p>
<ul>
<li>
<p><code>NavMask::add_layer(NavMaskLayer)</code>
Adds a layer on top of the <code>NavMask</code>. This clears the cache in <code>NavMask</code>.</p>
</li>
<li>
<p><code>NavMask::with_additional_layer(NavMaskLayer)</code>
Create a copy of a <code>NavMask</code> adding an additional <code>NavMaskLayer</code> on top. Useful if you have a common <code>NavMask</code> for your agents and just need to add a layer for a single agent.</p>
</li>
<li>
<p><code>NavMask::flatten()</code>
Merges all of the layers in the mask to a single layer. If you start running into performance issues with masks with a large number of layers this should be useful.</p>
</li>
<li>
<p><code>NavMask::clear()</code>
Clears all the layers and cached data from the mask.</p>
</li>
</ul>
<blockquote>
<p>⚠️ Arc Result
<code>NavMask</code> is an <code>Arc&lt;Mutex&gt;</code> wrapper.
All methods return a <code>Result</code>. Errors are returned as <code>String</code> if the data lock fails.</p>
</blockquote>
<h3 id="example-creating-a-navmask"><a class="header" href="#example-creating-a-navmask">Example: Creating a NavMask</a></h3>
<pre><pre class="playground"><code class="language-rust no_run">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let layer = NavMaskLayer::new();
layer.insert_region_fill(
    &amp;grid,
    NavRegion::new(UVec3::new(0, 0, 0), UVec3::new(10, 10, 10)),
    NavCellMask::ModifyCost(5),
).ok();

let mask = NavMask::new();
mask.add_layer(layer).ok();
<span class="boring">}
</span></code></pre></pre>
<h2 id="navcellmask"><a class="header" href="#navcellmask">NavCellMask</a></h2>
<p><code>NavCellMask</code> is an enum  has two options you can use to layer navigation data.
Currently it supports:</p>
<ul>
<li>
<p><code>NavCellMask::ImpassableOverride</code>: Will set the cell to impassable. Setting this for a cell on any layer will make the cell impassable no matter what any of the other layers are set to.</p>
</li>
<li>
<p><code>NavCellMask::ModifyCost(i32)</code>: The i32 past can be used to add or subtract to the overall cost of the cell. For example if you wanted water cells to cost more for infantry but not vehicles you could create a mask for the infanty units that uses ModifyCost(5) for example.</p>
</li>
</ul>
<h2 id="using-masks-in-pathfinding"><a class="header" href="#using-masks-in-pathfinding">Using Masks in Pathfinding</a></h2>
<p>Use the <code>AgentMask</code> component to associate a mask with a specific entity when using the plugin systems. 
Because <code>NavMask</code> is an <code>Arc</code> wrapper, it can be cloned without duplicating the data.</p>
<p>Using the Plugin Pathfinding systems:</p>
<pre><pre class="playground"><code class="language-rust no_run">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mask = NavMask::new();

commands
    .entity(player)
    .insert((
        Pathfind::new(UVec3::new(8, 8, 0),
        AgentMask(mask.clone()),
    ));
<span class="boring">}
</span></code></pre></pre>
<p>In direct manual pathfinding calls you can pass the mask with <code>PathfindArgs::mask</code>:</p>
<pre><pre class="playground"><code class="language-rust no_run">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let grid_settings = GridSettingsBuilder::new_2d(16, 16).build();
let grid = CardinalGrid::new(&amp;grid_settings);

let mask = NavMask::new();

let path = grid.pathfind(
    PathfindArgs::new(UVec3::new(0, 0, 0), UVec3::new(7, 7, 0))
        .mask(mask.clone())
);
<span class="boring">}
</span></code></pre></pre>
<h2 id="debugging-navmask"><a class="header" href="#debugging-navmask">Debugging NavMask</a></h2>
<p>You can debug a NavMask using <code>DebugGrid</code>. See <a href="./debugging.html">Debugging</a> for more information on setting up <code>DebugGrid</code>.</p>
<p>Example </p>
<pre><pre class="playground"><code class="language-rust no_run">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Resource)]
struct MyNavMasks(HashMap&lt;String, NavMask&gt;);

fn apply_debug_mask(debug_grid: Single&lt;&amp;mut DebugGrid&gt;, masks: Res&lt;MyNavMasks&gt;) {
    let mut debug_grid = debug_grid.into_inner();

    let mask = masks.0.get(&quot;example_mask&quot;).unwrap();
    debug_grid.set_debug_mask(mask.clone());
    // In order to view the debugged navigation masks, you'll need to enable debug cell gizmos
    debug_grid.set_draw_cells(true);

    // You can later clear the debug mask with:
    debug_grid.clear_debug_mask();
}
<span class="boring">}
</span></code></pre></pre>
<h2 id="performance-notes"><a class="header" href="#performance-notes">Performance Notes</a></h2>
<p>Adding a navigation mask to a pathfinding call will decrease the performance of the pathfinding. A navigation mask used in HPA* (Refined, Waypoint) pathfinding will cache any look ups that are done for future use. After a certain usage in HPA* the cost will greatly decrease.</p>
<p>Every change to the mask will currently clear the cache. You may want to avoid updating masks too frequently if you find you're running into performance issues.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="neighborhood/02_filters.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="debugging.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="neighborhood/02_filters.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="debugging.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
